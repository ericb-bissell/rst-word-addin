<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' https://appsforoffice.microsoft.com https://*.trycloudflare.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-src 'self' https:;">
  <title>RST Preview</title>
  <link rel="stylesheet" href="taskpane.css">
  <!-- Office.js -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
</head>
<body>
  <div id="app" class="taskpane-container">
    <!-- Header -->
    <header class="taskpane-header">
      <h1 class="taskpane-title">RST Preview</h1>
      <button id="help-btn" class="icon-btn" aria-label="Help" title="Help">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5zM9.5 8.25c-.5.5-.75.75-.75 1.25v.5h-1.5v-.5c0-1 .5-1.5 1-2l.5-.5c.25-.25.5-.5.5-1 0-.75-.5-1.25-1.25-1.25S6.75 5.25 6.75 6h-1.5c0-1.5 1.25-2.75 2.75-2.75S10.75 4.5 10.75 6c0 .75-.5 1.5-1.25 2.25z"/>
        </svg>
      </button>
    </header>

    <!-- Toolbar -->
    <div class="taskpane-toolbar">
      <button id="refresh-btn" class="toolbar-btn" title="Refresh preview">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M13.65 2.35A8 8 0 1 0 16 8h-2a6 6 0 1 1-1.76-4.24L10 6h6V0l-2.35 2.35z"/>
        </svg>
        <span>Refresh</span>
      </button>
      <button id="copy-btn" class="toolbar-btn" title="Copy RST to clipboard">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6z"/>
          <path d="M2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
        </svg>
        <span>Copy</span>
      </button>
      <button id="export-btn" class="toolbar-btn toolbar-btn-primary" title="Export as ZIP">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
          <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
        </svg>
        <span>Export</span>
      </button>
    </div>

    <!-- Main Content Area -->
    <main class="taskpane-main">
      <!-- Loading State -->
      <div id="loading-state" class="state-container" style="display: none;">
        <div class="spinner"></div>
        <p>Converting document...</p>
      </div>

      <!-- Error State -->
      <div id="error-state" class="state-container" style="display: none;">
        <div class="error-icon">!</div>
        <p id="error-message">An error occurred</p>
        <button id="retry-btn" class="toolbar-btn">Retry</button>
      </div>

      <!-- Empty State -->
      <div id="empty-state" class="state-container">
        <div class="empty-icon">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="currentColor" opacity="0.5">
            <path d="M8 4h24l8 8v32a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4zm22 2H8a2 2 0 0 0-2 2v36a2 2 0 0 0 2 2h28a2 2 0 0 0 2-2V14h-8V6zm2 0v6h6l-6-6zM12 20h20v2H12v-2zm0 6h20v2H12v-2zm0 6h14v2H12v-2z"/>
          </svg>
        </div>
        <p>Click <strong>Refresh</strong> to preview your document as RST</p>
      </div>

      <!-- Preview Content -->
      <div id="preview-container" class="preview-container" style="display: none;">
        <pre id="rst-preview" class="rst-preview"></pre>
      </div>
    </main>

    <!-- Status Bar -->
    <footer class="taskpane-footer">
      <span id="status-text">Ready</span>
    </footer>

    <!-- Help Panel (disabled for now due to CSP issues in Word Online) -->
    <div id="help-panel" class="help-panel" style="display: none;">
      <div style="padding: 20px; text-align: center;">
        <p>Help documentation is available at the project repository.</p>
        <p><small>Help panel disabled in Word Online due to security restrictions.</small></p>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast" style="display: none;">
    <span id="toast-message"></span>
  </div>
</body>
</html>
